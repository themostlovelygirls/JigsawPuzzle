# 详细设计文档

scene

|--loginScene

|--mainScene主界面

|--categoryScene闯关分类

|--roundScene选关

|--gameScene游戏场景

|--albumScene相册场景

|--recordScene战绩查询



script

|--loginScene

  ​	|--login.js

|--mainScene

  ​	|--main.js

|--categoryScene

  ​	|--category.js

|--roundScene

  ​	|--round.js

|--gameScene

  ​	|--game.js

|--albumScene

  ​	|--album.js

|--recordScene

  ​	|--record.js

### JS

```json
//login.js
authorize(){
  //1 得到授权
  //2 切换场景mainScene
  //userid全局存取
}

```

```json
//main.js
getBaseInfo(){
  //查询
}

//4个场景切换的函数
```

```json
//category
getUnlockedCategory(){
  
}
//场景切换进入闯关roundScence，传入分类
```

```json
//round.js
getRoundRecord(){
  //1 得到个人闯关记录<--difficulty
  //2 得到所有图片
}
```

```json
//game.js
//3X3 - 4 ; 4X4 - 8 ; 5X5 - 12
init(){
  //1 基本信息--用户头像，目标图片，倒计时(timeout)，用户道具数量，撤销
  //2 图片切片
  //3 初始地图生成
  //4 事件监听
  
  /**
   *单人
   *对战--通过云函数（？）初始化，倒计时同步
   */
}

isAlive(arr){
  //地图有解
}

toolClick(){
  //判断一下buy或swap
}

swap(x1,y1,x2,y2){
  //使用道具
  //记录x1,y1,x2,y2
  //撤销bool置为true
}


moveListener(){
  
}

//撤销bool置为true
//记录x1,y1,x2,y2
moveUp(){}
moveDown(){}
moveLeft(){}
moveRight(){}

cancelMove(){
  //调用swap
  //撤销bool置为false
}

isSuccess(){
  //闯关成功判断
  //用户积分、等级、图片、星星变动
  
  /**
   *单人
   *对战--发送消息，判定自己赢，对战成绩操作
   */
}

timeout(){
  /**
   *单人
   *对战--平局	
   */
}

buy(){
  
}

exit(){
  //对战--发送消息，判定对方赢
}

sendMessage(){}

```
```json
//album.js
showAlbum(){
  //得到解锁类别
}

showImages(category){
  //dao
}

```

```json
//record.js
getRecord(){
  
}
```

### DAO

```json
//得到所有图片及信息
getAllImage(category){
  //List每项: 图片primaryKey, name, url, description
}
//得到个人解锁图片
getUnlockedImage(userid, category, difficulty){
  //List每项: 图片primaryKey, stars
}
//得到个人解锁类别
getUnlockedCategory(userid){
  //List每项: category
}
//得到个人战绩
getRecord(userid){
  
}
//得到用户头像、微信ID、等级、积分、道具、星星
getBaseInfo(userid){
  
}
//得到个人闯关记录
getRoundRecord(difficulty){
  
}

updateTool(tool, userid){
  
}
updateStart(star, userid){
  
}

updataBaseInfo(userid, level, grade, imgIndex, time){
  
}

addRecord(userid, rivalid, winnnerid, time, imgName){
  
}

```

